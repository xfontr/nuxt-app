#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# üè∑ Get current branch name
local_branch_name="$(git rev-parse --abbrev-ref HEAD)"

# ‚úÖ Valid branch name pattern
valid_branch_regex='^((hotfix|bugfix|feature)\/[a-zA-Z0-9\-]+)$'

# üé® Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
RESET='\033[0m'

# üí° Branch name check
if [[ ! $local_branch_name =~ $valid_branch_regex ]]; then
  printf "${RED}‚úñ Invalid branch name: '${local_branch_name}'${RESET}"
  printf "${YELLOW}‚Üí Must follow: hotfix/xxx, bugfix/xxx, or feature/xxx${RESET}"
  exit 1
else
  printf "${GREEN}‚úî Valid branch: ${CYAN}$local_branch_name${RESET}"
fi

# ‚úÖ Run test and lint
printf "${CYAN}‚ñ∂ Running tests...${RESET}"
pnpm all:test || exit 1

printf "${CYAN}‚ñ∂ Running linter...${RESET}"
pnpm all:lint || exit 1

printf "${GREEN}‚úì All checks passed. Push approved.${RESET}\n"
exit 0